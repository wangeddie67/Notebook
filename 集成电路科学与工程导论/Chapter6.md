# 第6章 大规模数字集成电路

## 6.1 数字集成电路基础

$\triangle$​ 基于双极型（NPN或PNP）型晶体管的双极型集成电路（Bipolar Integrated Circuit, BIC）。

- 晶体管-晶体管逻辑（Transistor-Transistor Logic, TTL）电路、发射极耦合逻辑（Emitter Coupled Logic, ECL）电路、集成注入逻辑（Integrated Injection logic, I2L）电路、二极管-晶体管逻辑（Diode-Transistor Logic, DTL）电路和高阈值逻辑（High Threshold Logic, HTL）电路。

**图6.1 CMOS数字集成电路的分类**

### 6.1.1 组合逻辑电路与时序逻辑电路

$\triangle$ 组合逻辑电路是指在任意工作点，电路的输出状态仅取决于该时刻电路的输入，而与之前的状态无关的电路。

$\triangle$ 时序逻辑是指任何时刻，电路的输出状态不仅取决于该时刻电路的输入，还与之前的状态有关的电路。

- 时序逻辑电路中必然包含存储单元，有锁存器、触发器和寄存器（Register）。

**图6.2 组合逻辑电路和时序逻辑电路示意图**

#### 1. 常见组合逻辑电路实例

$\triangle$ 基本逻辑门：与门（AND Gate）、或门（OR Gate）、非门（NOT Gate）。复杂逻辑门由3种基本逻辑门组合而成的，有或非门（NOR Gate）、与非门（NAND Gate）和异或门（XOR Gate）。

**表6-1 常见的基本组合逻辑门和复杂组合逻辑门**

$\triangle$ 对于CMOS组合逻辑电路，每一个逻辑门都可以通过连接电源V~DD~和接地GND的上拉网络（Pull Up Network, PUN）和下拉网络（Pull Down Network, PDN）组成。

**图6.3 利用CMOS组合逻辑实现的反相器、两输入与非门和两输入或非门**

**图6.4 一个全加器的门级结构和逻辑真值表**

#### 2. 常见时序逻辑电路实例

$\triangle$ 时序有关的概念：

- 建立时间（Setup Time）：指在采样时钟边沿到来之前数字输入端必须保持稳定的时间。
- 保持时间（Hold Time）：指在采样时钟边沿到来之后数据输入端必须保持稳定的时间。
- 延迟时间$t_{C-Q}$：指采样时钟边沿到来与完成数据采样之间的时间。

**图6.5 时序逻辑电路中的建立时间、保持时间和延迟时间**

$\triangle$ 锁存器是一种对脉冲电平敏感的电路，最根本的工作原理都是基于双稳态电路对于数据的记忆功能。

**图6.6 负锁存器与正锁存器示意图**

$\triangle$ 寄存器只有在时钟上升沿或下降沿到来时才传输数据，其他时间保持数据。

**图6.7 主从结构的边沿触发寄存器及其工作时的时钟信号**

### 6.1.2 同步逻辑电路与异步逻辑电路

$\triangle$ 同步逻辑是指整个电路设计中只有一个本地时钟，而异步逻辑是指电路中存在多个时钟系统并且各个时钟之间没有固定的因果关系。

$\triangle$​ 同步逻辑电路是指所有时序逻辑单元采用同源时钟驱动，任意路径均满足时序建立时间约束和保持时间约束，其最高工作频率受限于延迟最长的路径（关键路径）。

- 同步逻辑电路分为同步互连、中等同步互连和近似同步互连。

#### 1. 同步互连

$\triangle$ 同步互连是指数据信号与本地时钟具有完全相同的频率和固定的相位差。

**图6.8 同步互连的方法**

#### 2. 中等同步互连

$\triangle$ 中等同步互连是指信号与本地时钟具有完全相同的频率，但具有未知的相位差。

**图6.9 利用可变延时线实现的中等同步互连方式**

#### 3. 近似同步互连

$\triangle$ 近似同步互连是指信号与本地时钟具有名义上相同的频率，但真正的频率却少有不同，另个时钟间的相位差将随时间偏移。

- 利用先进先出（First In First Out，FIFO）寄存器的近似同步互连方式。

**图6.10 一种利用FIFO寄存器的近似同步互连方式**

$\triangle$ 异步逻辑电路是指无时钟同步或者由非同源时钟驱动的时序逻辑电路，电路性能取决于电路延迟本身。

$\triangle$​ 实现异步逻辑电路不同模块之间的数据通信：

- 一种是通过检测信号的随意变化并将等待时间引入与本地时钟同步的数据流中；
- 另一种是完全取消本地时钟，采用自定时的异步电路，通过握手协议时间模块间正确的操作次序。

**图6.11 一种异步逻辑电路的设计方式**

### 6.1.3 静态逻辑电路与动态逻辑电路

$\triangle$ 静态逻辑电路通过低阻通路连接到电源或地，从而实现逻辑1和0。动态逻辑电路通过维持保存在寄生电容器上的电荷来实现逻辑0和1相比。

- 静态逻辑电路具有良好的稳定性，所占面积大、延迟大；
- 动态逻辑电路延迟小，抗噪声能力差、功耗高。

#### 1. 静态互补CMOS逻辑

$\triangle$ 由PUN和PDN组成的静态互补CMOS逻辑电路。

**图6.12 PUN和PDN组成的静态互补CMOS逻辑电路示意图**

#### 2. 传输管逻辑

$\triangle$ 通过输入驱动栅极和源漏端来减少实现逻辑锁需要用的晶体管数量。

**图6.13 NMOS传输管实现的与门设计和传输管逻辑的阈值损失示意图**

#### 3. 有比逻辑

$\triangle$ 有比逻辑以降低电路稳定性和增加功耗为代价，可以减少所需的晶体管数量。

- PUN被一个负载$R_L$​代替，又称为伪NMOS静态逻辑门。
- 通过调节NMOS和PMOS的尺寸比来优化伪NMOS静态逻辑门的噪声容限、功耗和传播延时等参数。

**图6.14 一般有比逻辑示意图**

**图6.15 伪NMOS静态逻辑门与N型动态逻辑门**

$\triangle$ 动态CMOS逻辑门通过增加时钟输入达到减少晶体管数量的目的，同时规避静态功耗的问题。

- 预充电阶段和求值阶段



## 6.2 数字集成电路设计方法概述

$\triangle$ 数字集成电路设计需要综合考虑性能、功耗、稳定性、面积、成本与产量等因素。

- 性能指数字集成电路处理数字信号的吞吐量，一般指主频。
- 功耗指电路工作时消耗的动态功耗和静态功耗的组合。
- 稳定性指电路抗噪声、抗工艺涨落的能力。
- 面积和成本成正比，成本指电路设计和加工成本、封装费用和测试成本的总和。
- 产量指完成设计后工艺厂商的出货量。

**图6.16 数字集成电路的设计方法**

### 6.2.1 基于门阵列的半定制电路

$\triangle$ 基于门阵列的本定制电路：一类是早期的预扩散门阵列或者门海，另一类是基于预布线的现场可编程逻辑门阵列（Field Programable Gate Array, FPGA）。

$\triangle$ 可编程逻辑阵列PLD（Programmable Logic Array, PLA）；可编程阵列逻辑PAL（Programmable Array Logic）；通用阵列逻辑GAL（Generic Array Logic），复杂可编程逻辑器件（Complex Programmable Logic Device, CPLD）。

**图6.17 一种典型的岛式FPGA的内部结构示意图**

$\triangle$ FPGA设计方法的发展分为3个阶段，即硬件描述阶段、嵌入式软核阶段和异构系统阶段。

### 6.2.2 基于标准单元的半定制电路

$\triangle$ 标准单元包含两类

- 由生产厂商提供的可供逻辑门设计实体化的库文件
- 另一类标准单元是指宏单元，不受限于统一的高度，如IP。

$\triangle$​ ASIC是指针对特定用途专门定制的集成电路，与CPU和FPGA相比，具有更好的性能和更低的功耗。

$\triangle$ ASIC设计流程：

- 顶层设计团队根据系统设计和规范（System Design and Specification）进行架构方面的设计并划片（Partition）；
- 模块前端设计团队用硬件描述语言编写RTL代码，并进行功能仿真，同时决定芯片的尺寸；
- 功能仿真完成后，需要综合优化产生网表，并由验证团队负责搭建测试平台，测试不同情境下的功能正确性；
- 最后可测性设计团队会插入一些与可测性设计相关的逻辑、最终生成一个门级网表；
- 后端设计团队拿到网表后，物理设计团队需要不断进行布局、布线、时钟树综合工作以使芯片的时序、面积和功耗达到要求甚至达到最佳状态。
- 最终通过设计规则检查、版图和电路的一致性检查、时序收敛测试，以及其他各项细致的检查，确保无误后方可签核（Sign-off），交付给工艺厂商进行制造。

**图6.18 一个典型的ASIC设计流程**

### 6.2.3 可重构计算电路

$\triangle$ 可重构芯片的主要特征包括：

- 在芯片制造完成之后，其功能仍然可以订制，并应用于特定的任务；
- 芯片计算功能的实现主要依靠软件功能到芯片的映射。

**图6.19 可重构计算架构与现有主流计算架构在能量效率和灵活性上的对比**



## 6.3 中央处理器

$\triangle$ 计算器的三个组成要素：中央处理单元（Central Processing Unit, CPU）、内部存储器和I/O设备。

$\triangle$ CPU主要功能：从计算机程序或外围设备（键盘、鼠标和打印机等）获取输入、读取并理解相关指令，从而对数据进行处理并将运行结果输出到显示器或执行外围设备的请求任务。

**图6.20 计算机系统的组成**

### 6.3.1 中央处理器的功能和组成

#### 1. 处理器的主要功能

$\triangle$ CPU的主要功能包括：指令顺序控制、操作信号控制、时序控制、处理数据。

$\triangle$ CPU处理数据的过程：取指令、指令译码、执行指令、数据读取、指令完成。

#### 2. CPU基本组成与运行原理

**图6.21 CPU架构与工作原理示意图**

$\triangle$ 控制单元、运算单元、存储单元。

#### 3. CPU的性能评价指标

$\triangle$ 主频、外频、基础字长、数据总线宽度、工作电压、制造工艺。

### 6.3.2 中央处理器的分层模型与指令集架构

#### 1. CPU的分层模型

$\triangle$ 指令集架构（Instruction Set Architecture, ISA）在软件开发人员和处理器设计人员之间提供一个抽象层，将软件开发人员所需要了解的硬件信息从硬件系统中提取出来。

$\triangle$ 在硬件系统中，指令集架构中每一条指令的具体实现称为微架构（Microarchitecture）。

- 微架构包括：指令数字电路、流水线结构、存储器结构、各指令的周期计数、缓存的数量和大小，以及管道长度和布局等。

**图6.22 处理器的分层模型**

#### 2. CPU指令集架构

**图6.23 指令集架构示意图**

$\triangle$ 指令集架构包含的内容：指令格式、寻址方式、系统模型、数据类型、寄存器、外部接口。

$\triangle$ 指令集架构中的指令：运算指令、分支指令、访存指令。

$\triangle$ 复杂指令集（Complex Instruction Set Computing, CISC）和精简指令集（Reduced Instruction Set Computing, RISC）

- CISC特点：指令功能丰富、指令数量多。

**表6.2 CISC架构与RISC架构特性对比**

**图6.24 处理器运算模型**

**表6.3 指令编码**

**表6.4 操作数编码**

**表6.5 加法指令格式**

**表6.6 加法操作机器码**

### 6.3.3 经典指令集架构简介

#### 1. x86指令集架构

**图6.25 英特尔从Tick-Tock模型放缓到三步走战略**

#### 2. ARM指令集架构

**图6.26 ARM架构的主要特征**

**图6.27 ARM架构的发展历程**

**表6.7 ARM 3类处理器的特点**

#### 3. MIPS

#### 4. RISC-V

**图6.28 RISC-V基金会部分成员**

### 6.3.4 中央处理器的发展趋势



## 6.4 图形处理器

$\triangle$ 图形处理器（Graphics Processing Unit, GPU）：专用的图形加速电路和可编程图形加速芯片统一称为GPU。

- 大规模并行处理（Massively Parallel Processing, MPP）的系统级芯片。

**图6.30 包含GPU的NVIDIA Xavier芯片**

### **6.4.1 三维图形处理流程**

**图6.31 典型的三维GPU的数据处理流程**

$\triangle$ 典型的三维GPU的数据处理过程：顶点处理、三角形设置/剪切、光栅化计算、纹理贴图、合成处理。

### 6.4.2 图形处理器的组成与架构

**图6.32 CPU和GPU的逻辑架构对比**

$\triangle$ CPU在多媒体处理中的缺陷很明显。多媒体计算需要较大的运算密度、多线程和频繁地访问存储器。

$\triangle$ CPU和GPU的不同点：线程的轻重程度不同；CPU可以看做多核处理器、GPU可以看做众核处理器，GPU和GPU中寄存器与内存的数量和复杂度不同；CPU和GPU的缓存机制不同。

$\triangle$ 通用图形处理器（General Purpose Computing on Graphics Processing Unit, GPGPU），适合计算数据流。

**图6.33 GPU编程库**

### 6.4.3 主流图形处理器介绍

**图6.34 NVIDIA A100 Tensor Core GPU的详细性能参数**

### 6.4.4 图形处理器的发展趋势



## 6.5 类脑计算芯片

### 6.5.1 类脑计算芯片的发展机遇及挑战

$\triangle$ 现代计算芯片面临的挑战：存储墙和功耗墙问题；摩尔定律的终结。

**图6.35 存储墙、功耗墙问题以及摩尔定律的终结**

$\triangle$ 类脑计算芯片往往采用模拟人脑神经网络对信息感知和决策的方式进行信息的收集、传输、处理和存储，更适于在硬件平台上实现信息分布式计算与存储一体化。

- 分为两大类：深度学习处理器和神经形态芯片。

**图6.36 类脑计算芯片的分类**

### 6.5.2 深度学习处理器

**图6.37 深度学习与ANN、机器学习及人工智能的关系**

#### 1. 单层感知器阶段

#### 2. 多层感知器阶段

#### 3. 深度神经网络

**表6.8 3类典型深度歇息芯片对比**

**图6.38 现有的深度学习网络类型及计算量示意图**

### 6.5.3 神经形态芯片

**表6.9 典型的神经形态芯片与人脑的数据对比**



## 6.6 片上系统

### 6.6.1 片上系统概述

$\triangle$ SoC将整个信息处理系统集成在一个芯片上。

$\triangle$ SoC一般包含一个或多个微处理器、GPU、DSP、嵌入式片上存储、图像信号处理器（ISP）、基带单元（BBU）、音频处理器、WiFi模块、串行外设接口（SPI）和DAC等功能模块。以及，TPU、NPU等。

**图6.39 SoC可包含的模块**

$\triangle$ 系统级封装（System in Package，SIP），使用通用的二维或三维衬底将单独的芯片封装到一个系统中。

$\triangle$ SoC显著特点：首先基于第三方IP核进行设计，硬件规模庞大；其次是SoC设计复杂的软硬件协同设计。

### 6.6.2 可复用IP核

$\triangle$ IP核：基于ASIC或FPGA预先设计好的电路功能模块。

- 分为3类，软核（Soft IP Core）、固核（Firm IP Core）和硬核（Hard IP Core）。

$\triangle$ 软核：使用RTL或更高级藐视定义的功能块；硬核是具有固定版图，针对特定应用程序和工艺高度优化的工艺的功能块；固核提供参数化描述的电路功能块。

**图6.40 2019年半导体IP核市场上几大核心厂商的份额**

### 6.6.3 片上系统实例

**图6.41 麒麟980芯片的显微镜照片**

**表6.10 华为海思旗舰SoC的参数**

**图6.42 苹果发布的M1芯片架构示意图及内部结构**



## 本章小结