# 第10章 集成电路设计自动化技术

**图10.1 EDA工具、集成电路制造厂商和集成电路设计公司的关系**

## 10.1 电子设计自动化技术简介

### 10.1.1 电子设计自动化技术的起源

$\triangle$ EDA产业发展的四个阶段：诞生阶段、自动化阶段、全自动化阶段和智能化阶段。

**表10.1 EDA产业的出现及演化**

### 10.1.2 电子设计自动化技术的发展现状

**图10.2 2018年全球EDA产业市场格局**

**表10.2 中国EDA产业的主要公司及产品**

### 10.1.3 常用工具及分类

$\triangle$ 电子电路领域的一些设计可以分为系统级，电路级和物理实现级。

$\triangle$ 从应用领域来讲，又分为集成电路（Integrated Circuit, IC）设计、印刷电路板（Printed Circuit Board, PCB）设计和可编程逻辑电路（Programmable Logic Device）设计。

**表10.3 代表性EDA软件及功能**

$\triangle$ IC工具设计主要面向全定制化集成电路；PCB设计工具主要面向电子系统设计；PLD设计工具主要用于半定制的大规模集成电路开发功能验证。



## 10.2 模拟集成电路设计自动化

$\triangle$​ IC设计工具包括原理图设计工具（Virtuoso Schematic Composer）、模拟信号设计环境（Analog Design Environment, ADE）、仿真器（Spectre/Eldo）和版图设计工具（Virtuoso Layout Editor）。

$\triangle$​ 版图验证工具包括设计规则检查（Design Rule Check, DRC）、版图与电路图一致性检查（Layout Versus Schematic, LVS）和寄生参数提取（Parasitic Extraction, PEX）。

**图10.3 模拟电路设计流程及常见软件**

### 10.2.1 库文件与器件模型

**图10.4 新建View可选择的种类**

#### 1. 库文件

**图10.5 PDK中包含的内容**

$\triangle$ PDK中包含的文件：

-  仿真模型通常由工艺厂商提供。
- 参数化单元是一种可编程单元，允许用户通过定义参数创建实例。
- 标准单元库是工艺厂商预先设计好的优化的库单元。
- 工艺文件主要包含技术文件、显示文件和映射关系文件。
- 物理验证规则文件则包含设计规则、检查版图和原理图一致性检查和寄生参数提取的文件。

**图10.6 库文件的种类与关系**

#### 2. 器件模型

$\triangle$ VerilogA建模。

### 10.2.2 电路设计与仿真

**图10.7 电路原理图设计与仿真流程及各步骤对应的软件操作**

#### 1. 电路原理图设计

#### 2. 仿真设置

$\triangle$ 仿真设置包含环境设置、工艺角设置、类型设置和输出信号设置。

#### 3. 结果分析

**图10.8 软件绘制的反相器电路原理图及其瞬态仿真结果**

**图10.9 Cadence输出的蒙特卡罗仿真结果**

### 10.2.3 版图设计与验证

$\triangle$​ 版图设计师将电路原理图转化为可以提供给工艺厂商进行制造的物理设计。

#### 1. 版图的基本概念

$\triangle$ 器件的版图

**图10.10 软件中NMOS的电路图形符号、立体图及版图**

$\triangle$ 金属连接层（Metal）。

$\triangle$ 工艺文件。Graphic Data System II (GDSII/GDS2）记录版图信息的文件格式

- 映射文件（Layermap）、技术文件（Technology File）、显示文件（Display File）

$\triangle$ 设计规则（Design Rule）

**图10.12 5中常见的集成电路版图设计规则**

#### 2. 版图设计

**图10.13 版图设计与版图验证的流程和各步骤对应的软件操作**

**图10.14 需要避免的容易产生寄生电容的布线方式**

#### 3. 版图验证

$\triangle$ 4个步骤：DRC、LVS、PEX和后仿真。

**图10.15 一个STT-MRAM的电路架构图和版图**

**图10.16 读电路原理图仿真（PRE）和后仿真（POST）结果对比**

#### 4. 面向先进工艺节点的版图验证工具



## 10.3 数字集成电路设计自动化

### 10.3.1 设计流程概述

$\triangle$ 数字集成电路自动化设计的流程分为两个部分，前端设计和后端设计

- 前端设计主要包括系统功能描述、寄存器传输及电路设计及前仿真、逻辑综合、门级仿真、静态时序、功耗分析。
- 后端设计主要包括物理设计、寄生参数提取、时序/功耗分析及后仿真、设计规则与版图一致性检查。

$\triangle$ 数字集成电路设计中使用最广泛的方法是层次化设计，包括自底向上和自顶向下两种。

$\triangle$ 整个层次化设计包括行为与结构域和几何域。

- 行为域设计主要考虑电路功能的描述，
- 结构域设计的目的是确定电路的具体结构。
- 集合域设计将电路原理图转化为物理版图。

**图10.17 数字集成电路设计流程**

### 10.3.2 RTL设计

$\triangle$ RTL设计就是指利用硬件描述语言对上述组合逻辑电路和时序逻辑电路进行描述。

$\triangle$ 硬件描述语言可以通过三种建模方式完成电路的设计，结构级建模，数据流建模和行为级建模。

- 结构级建模是指根据电路原理图，实例化模块。
- 数据流建模是指根据电路的逻辑表达式，利用延续赋值语句描述电路行为。
- 行为级建模是指通过描述电路的逻辑行为对电路进行建模。

$\triangle$ 利用高层综合工具实现从算法级的行为描述到RTL的硬件描述的转换。将行为描述文件编译成数据流图，然后将数据流图映射到资源库中的功能电路，满足设计目标。

- 高层综合通常有资源分配、时序规划、资源绑定、生成代码四个阶段组成。

### 10.3.3 逻辑综合

$\triangle$ 逻辑综合通常指将RTL代码所描述的逻辑功能和用户所要求的性能，基于一个完备的逻辑单元库，转换成满足相关约束条件的门级网表的过程。

$\triangle$ 逻辑综合过程通常包含三个输入：一是RTL代码描述的逻辑功能或程序模块；二是综合工具支持的工艺库；三是逻辑综合的约束条件

- 约束条件一般包含芯片面积，工作频率，芯片功耗，负载要求，设计规则等。

$\triangle$​ 逻辑综合由三个过程组成：分别是转译（Translation）、优化（Optimization）、映射（Mapping）。

- 优化包括公因子提取、资源分配、交换律和结合律的运用、公共子表达式、死代码消除及常量合并、代码移位等。

**图10.21 逻辑综合示意图**

### 10.3.4 物理设计

$\triangle$​ 物理设计的输入是门级网表以及电路和元器件的描述，根据工艺要求，物理设计将每个元器件的电路以及元器件之间的互联线网转换成几何图形，其最终输出为电路板图。

$\triangle$ 版图有多种模式，常用的模式有积木块儿（Building Block Layout, BBL）模式、门阵列（Gate Array）模式、门海（Sea of Gates）模式和标准单元（Standard Cell）模式。

$\triangle$ 标准单元模式是具有高度灵活性的半定制设计方法。设计效率高，设计周期短，自动化程度高。

#### 1. 布图规划

$\triangle$ 版图规划的主要目的是为整个芯片和各个子模块，设计一个高质量的不同方案。

$\triangle$ 传统的布局规划输入为

- 电路划分过程之后的N个电路子模块
- 子模块间的互联网表
- 各子模块的尺寸
- 各线网引脚在模块上的相对位置。

$\triangle$ 布图规划输出为N个子模块，在芯片上的位置坐标以及取向。

$\triangle$ 布图规划的优化目标为

- 最小化所有模块外包矩形边框的面积
- 优化设计的总线长。

$\triangle$ 布图规划的约束条件为：模块之间必须满足不重叠的约束。

$\triangle$​ 布图规划可以分为两类：二分结构（Slicing Structure）布图和非二分结构（Non-Slicing Structure）布图。

$\triangle$ 布图规划算法可以大体分为随机优化算法和确定性算法两类。

- 随机优化算法，通过迭代的方式寻找最优解。遗传算法（Genetic Algorithm, GA）和模拟退火算法（Simulated Annealing, SA）是典型的随机优化算法。
- 确定性算法又可分为启发式算法和解析式算法两个子类。启发式算法通常是基于贪心策略。

**图10.22 两种布图结构**

**图10.23 布图规划执行前后，芯片版图的变化**

#### 2. 布局

$\triangle$ 布局阶段的输入是版图规划之后的网表以及一些相应的工艺库，其任务是为所有标准单元实例确定其在各自模块中的具体位置和摆放方向。

- 其目标是最小化芯片面积，
- 同时考虑芯片的可布行、拥挤度，时延等其他条件。

$\triangle$ 布局过程由总体布局和详细布局两个子过程组成。

- 总体布局，确定所有标准单元的大致分布位置。
- 详细布局阶段会将布局单元实例放置到行上，同时消除所有单元之间的重叠。
- 详细布局阶段，还将对单元位置进行进一步的调整，进行局部的问题修复和优化。

$\triangle$ 布局算法可分为构造型算法和迭代型算法两类

- 构造型算法是根据电路的结构，直接计算出各个单元的摆放位置。运行速度快，但是布局指令差。
- 迭代型算法中，布局器首先有一个初始布局结果。然后在初始解的接触式不断迭代和优化，直到满足布局算法的终止条件。迭代次数多，运行时间长，但是质量较高。

$\triangle$ 布局算法采用自上而下、分而治之的思路。在一定约束条件下，把规模较大的布局问题划分为若干规模较小的布局。

$\triangle$ 模拟退火算法。

$\triangle$ 解析式布局算法的核心思想是把布局问题转化为在有约束的最优化问题。以最小线长、时延为目标函数，以拥挤度等为约束条件。

$\triangle$ 力驱动布局算法，将布局问题和力学问题进行类比。

**图10.24 布局完成后的芯片版图及局部放大图**

#### 3. 布线

$\triangle$ 根据网表文件给出的逻辑互联关系，以及布局阶段提供的单元的具体位置，确定线网互联方案，以保证芯片功能的正确性。

$\triangle$ 布线一般分为两个步骤完成：第一步是总体布线（Global Routing, GR），其任务是完成布线资源的合理分配，以提高布通率、降低拥挤度为目标，将布线资源合理的分配给线网；第二步是详细布线（Detailed Routing, DR），其任务是根据粗粒度的路径分配信息，进行模块之间、点到点之间的连接，最终确定金属线和通孔的精确位置。

**图10.25 布线示意图**

$\triangle$ 布线问题输入一般是：

- 网表
- 布局信息
- 特殊线网的时延信息
- 每层线网单位长度金属线的电容、电阻信息，以及每种通孔的电容、电阻信息
- 版图设计规则

$\triangle$ 布线问题输出一般是：通过几何版图完成所有线网的连接，同时满足设计规则要求，并优化给定的目标参数。

$\triangle$ 布线问题的优化目标：

- 布通率
- 布线总线长
- 通孔数量
- 串扰和时延
- 可制造性设计

$\triangle$ 布线问题的约束：

- 线网连接的正确性
- 布线障碍
- 版图设计规则

$\triangle$ 李氏算法（Lee's Algorithm），搜索空间大，运行时间长。

$\triangle$ 迷宫布线算法（Maze Routing Algorithm）：为一对节点寻找连接路径。内存过多，运行时间长。

$\triangle$ 线搜索算法（Line-Search Algorithm）：基于深度优先搜索。

$\triangle$​ A\*搜索算法（A\* Search Algorithm）：基于广度优先算法，引入代价函数。

**图10.26 布线完成后的芯片版图及局部放大图**



## 10.4 基于人工智能的EDA技术

$\triangle$ 利用机器学习加速EDA

- 布线
- 逻辑仿真
- 化学抛光



## 本章小结