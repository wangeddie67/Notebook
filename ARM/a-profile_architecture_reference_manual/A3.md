# A3 Armv9架构扩展

本章介绍Armv9架构版本和扩展。包含如下章节：

- Armv9-A架构扩展。


## A3.1 Armv9-A架构扩展

Armv9-A架构的实现必须本章中表示为强制性的扩展集。这样的实现也称为Armv9-A架构实现。

在EL0中，AArch32架构的实现是可选的。在EL1、EL2、EL3中不实现AArch32架构。

Armv9实现中禁止出现FEAT_DoubleLock的实现。

Armv9-A结构的实现不能包含ETM。

Armv9架构增加了下列特性，通过架构特性名称和特性的简要描述来区分。

**FEAT_SVE2，可扩展的向量扩展，版本2**

可扩展向量扩展，版本2（SVE2）是SVE的超集，合并与先进SIMD相似的功能以及其他加强。在这个手册中，除非特别说明，当使用术语SVE时，行为也适用于SVE2。

只有AArch64架构支持这个特性。

在Armv9.0实现中，这个特性是*可选的*。标准Armv9-A软件平台支持FEAT_SVE2。

这个特性需要FEAT_SVE。

下面的域标识了FEAT_SVE2的出现：ID_AA64PFR0_EL1.SVE、ID_AA64ZFR0_EL1.SVEver。

更多信息参见[A2](A2.md)中*可扩展向量扩展*和[C3](C3.md)中*数据处理-SVE2*。

**FEAT_SVE_BitPerm，可扩展的向量比特置换指令**

FEAT_SVE_BitPerm提供SVE比特置换指令：`BEXT`、`BDEP`、`BGRP`。

只有AArch64架构支持这个特性。

在Armv9.0实现中，这个特性是*可选的*。

FEAT_SVE_BitPerm需要FEAT_SVE2。

ID_AA64ZFR0_EL1.BitPerm域标识了对于FEAT_SVE_BitPerm的支持。

**FEAT_SVE_PMULL128，可扩展的向量PMULL指令**

FEAT_SVE_PMULL128提供SVE 128比特多项式乘法指令：`PMULLB`、`PMULLT`。

只有AArch64架构支持这个特性。

在Armv9.0实现中，这个特性是*可选的*。

FEAT_SVE_PMULL128需要FEAT_SVE2。

ID_AA64ZFR0_EL1.AES域标识了对于FEAT_SVE_PMULL128的支持。

**FEAT_SVE_SHA3，可扩展的向量SHA3指令**

FEAT_SVE_SHA3提供SVE SHA3加解密指令：`RAX1`。

只有AArch64架构支持这个特性。

在Armv9.0实现中，这个特性是*可选的*。

FEAT_SVE_SHA3需要FEAT_SVE2。

ID_AA64ZFR0_EL1.SHA3域标识了对于FEAT_SVE_SHA3的支持。

**FEAT_SVE_SM4，可扩展的向量SM4指令**

FEAT_SVE_SM4提供SVE SM4加解密指令：`SM4E`、`SM4EKEY`。

只有AArch64架构支持这个特性。

在Armv9.0实现中，这个特性是*可选的*。

FEAT_SVE_SM4需要FEAT_SVE2。

ID_AA64ZFR0_EL1.SM4域标识了对于FEAT_SVE_SM4的支持。

**FEAT_ETE，嵌入式记录扩展**

FEAT_ETE提供一个记录单元来记录PE上运行的软件控制流的细节，记录可以用于帮助调试或优化。记录单元提供过滤功能，允许将信息指向特定的代码段或操作片段。

AArch64架构支持这个特性，并且在AArch64和AArch32架构中都能够记录。

在Armv9.0实现中，这个特性是*可选的*。

特性需要FEAT_TRBE和FEAT_TRF。

ID_AA64DFR0_EL1.TraceVer域标识了FEAT_ETE的出现。

更多信息参见[D4](D4.md)中*嵌入式记录扩展*。

**FEAT_TME，事务级存储扩展**

FEAT_TME引入一系列指令，用来支持硬件事务级存储。意思是，一组指令组合在一起，像一个原子操作一样执行。指令的更多信息，参见 `TCANCEL`、`TCOMMIT`、`TSTART`、`TTEST`。

只有AArch64架构支持这个特性。

在Armv9.0实现中，这个特性是*可选的*。

ID_AA64ISAR0_EL1.TME域标识了FEAT_TME的出现。

更多信息参见中*事务级存储扩展（TME）*。

**FEAT_TRBE，记录缓存扩展**

FEAT_TRBE提供在PE内的记录缓存，当记录缓存单元使能的时候，记录单元产生的程序流记录，通过记录缓存单元直接写入内存，而不是将记录数据发送给记录汇集点。

AArch64架构支持这个特性，并且在AArch64和AArch32架构中都能够记录。

在Armv9.0实现中，这个特性是*可选的*。

FEAT_TRBE需要FEAT_ETE和FEAT_TRF。

ID_AA64DFR0_EL1.TraceBuffer域标识了FEAT_TRBE的出现。

更多信息参见[D6](D6.md)中*记录缓存扩展*。

**FEAT_ETEv1p1，嵌入式记录扩展**

FEAT_ETEv1p1扩展FEAT_ETE来支持FEAT_FGT。

AArch64架构支持这个特性，并且在AArch64和AArch32架构中都能够记录。

在Armv9.1实现中，这个特性是*可选的*。

特性需要FEAT_ETE。

TRCDEVARCH.REVISION域标识FEAT_ETEv1p1的出现。

更多信息参见[D4](D4.md)中*嵌入式记录扩展*。

**FEAT_BRBE，分支记录缓存扩展**

FEAT_BRBE提供分支记录缓存，以捕获控制通路的历史。

只有AArch64架构支持这个特性。

在Armv9.2实现中，这个特性是*可选的*。

ID_AA64DFR0_EL1.BRBE域标识了FEAT_BEBE的出现。

更多信息参见[D15](D15.md)中*分支记录缓存扩展*。

**FEAT_ETEv1p2，嵌入式记录扩展**

FEAT_ETEv1p2扩展FEAT_ETE来支持FEAT_RME。

AArch64架构支持这个特性，并且在AArch64和AArch32架构中都能够记录。

在Armv9.2实现中，这个特性是*可选的*。

特性需要FEAT_ETEv1p1。

如果实现了FEAT_RME，需要这个特性，而且需要实现FEAT_ETE。

TRCDEVARCH.REVISION域标识FEAT_ETEv1p2的出现。

更多信息参见*域管理扩展（RME）*。

**FEAT_BRBEv1p1，分支记录缓存扩展**

FEAT_BRBEv1p1使能在EL3的分支记录。

只有AArch64架构支持这个特性。

这个特性需要FEAT_BRBE。

如果实现了FEAT_BERE，Armv9.3兼容的实现包含FEAT_BRBEv1p1这个特性。

ID_AA64DFR0_EL1.BRBE域标识了FEAT_BEBEv1p1的出现。

更多信息参见[D15](D15.md)中*分支记录缓存扩展*。

**FEAT_RME，域管理扩展**

FEAT_RME是Arm可信计算架构（Arm CCA）的组件。与其他Arm CCA组件一起，RME使能在Arm PE上运行动态、可证明的和可信任的执行环境（Realm）。

只有AArch64架构支持这个特性。

在Armv9.2实现中，这个特性是*可选的*。

FEAT_RME需要FEAT_RNG或FEAT_RNG_TRAP使能。

如果实现了记录架构，实现FEAT_RME的PE还需要实现FEAT_ETEv1p2。

更多信息参见*域管理扩展（RME）*。

**FEAT_SME，可扩展矩阵扩展**

FEAT_SME引入两种AArch64扩展模式，可以通过应用软件使能和关闭：

- 在ZA模式，使能可扩展的、两维、架构层面的ZA矩阵存储，定义指令进行ZA矩阵的load、store、提取、插入、清除行和清除列。
- 在流式SVE模式，有效的SVE向量长度变为与有效的ZA矩阵宽度匹配，支持SVE2指令集的一部分子集。当ZA模式也使能的时候，定义指令累计两个SVE向量的外积到ZA矩阵。

只有AArch64架构支持这个特性。

在Armv9.2实现中，这个特性是*可选的*。

ID_AA64PFR1_EL1.SME指示FEAT_SME的出现。

更多信息参见*可扩展矩阵扩展*。

**FEAT_SME_FA64，完整流式SVE模式指令**

FEAT_SME_FA64支持在流式SVE模式下的完整A64指令集。

只有AArch64架构支持这个特性。

在Armv9.2实现中，这个特性是*可选的*。

FEAT_SME_FA64需要FEAT_SME。

ID_AA64SMFR0_EL1.FA64指示对于FEAT_SME_FA64的支持。

更多信息参见*可扩展矩阵扩展*。

**FEAT_EBF16，AArch64扩展BFloat16指令**

FEAT_EBF16支持扩展的BFloat16模式。

只有AArch64架构支持这个特性。

在Armv9.2实现中，这个特性是*可选的*。

FEAT_EBF16需要FEAT_SME。

ID_AA64ISAR1_EL1.BF16和ID_AA64ZFR0_EL1.BF16指示FEAT_EBF16的出现，而且必须返回相同的值。

更多信息参见*可扩展矩阵扩展*。

**FEAT_SME_F64F64，双精度浮点外积指令**

FEAT_SME_F64F64表示累加到ZA矩阵中FP64双精度浮点元素的SME指令。

只有AArch64架构支持这个特性。

在Armv9.2实现中，这个特性是*可选的*。

FEAT_SME_I16I64需要FEAT_SME。

ID_AA64SMFR0_EL1.F64F64域指示对FEAT_SME_F64F64的支持。

更多信息参见*可扩展矩阵扩展*。

**FEAT_SME_I16I64，16比特到64比特整形扩展、外积指令**

FEAT_SME_I16I64表示累加到ZA矩阵中64比特整形元素的SME指令。

只有AArch64架构支持这个特性。

在Armv9.2实现中，这个特性是*可选的*。

FEAT_SME_I16I64需要FEAT_SME。

ID_AA64SMFR0_EL1.I16I64域指示对FEAT_SME_I16I64的支持。

更多信息参见*可扩展矩阵扩展*。

### A3.1.1 Armv9-A架构的架构需求

与Armv9兼容的实现，必须也是Armv8.5兼容。

与Armv9.1兼容的实现，必须也是Armv8.6和Arm9.0兼容。

与Armv9.2兼容的实现，必须也是Armv8.7和Arm9.1兼容。

与Armv9.3兼容的实现，必须也是Armv8.8和Arm9.2兼容。
